<%#
name: Demo
snippet: false
template_inputs:
- name: Organizations filter
  required: false
  input_type: user
  advanced: false
  value_type: search
  resource_type: Organization
model: ReportTemplate
-%>
<%- report_headers 'Organization', 'Hosts', 'CPUs', 'RAM', 'Daily cost' -%>
<%- load_organizations(search: input('Organizations filter')).each_record do |org| -%>
<%-   hosts_counter, ram_counter, cpus_counter = 0, 0, 0 -%>
<%-   load_hosts(search: "organization_id = #{org.id}").each_record do |host| -%>
<%-     hosts_counter += 1 -%>
<%-     ram_counter += host.ram || 0 -%>
<%-     cpus_counter += host.cores || 0 -%>
<%-   end -%>
<%-   report_row(
        'Organization': org.name,
        'Hosts': hosts_counter,
        'CPUs': cpus_counter,
        'RAM': number_to_human_size(ram_counter * 1024 * 1024),
        'Daily cost': number_to_currency(ram_counter / 1024 * 0.01 + cpus_counter * 0.02)
      ) -%>
<%- end -%>
<%= report_render %>